---
phase: 01-infoplist-uti-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [dotViewer/Info.plist, QuickLookPreview/Info.plist]
autonomous: false
---

<objective>
Fix TypeScript/TSX QuickLook preview (UAT-002).

Purpose: Enable QuickLook code preview for .ts and .tsx files. Currently showing document icon instead of syntax-highlighted code despite UTI declarations being present.
Output: Working QuickLook preview for TypeScript files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infoplist-uti-fixes/01-01-SUMMARY.md
@.planning/phases/01-infoplist-uti-fixes/01-01-ISSUES.md
@dotViewer/Info.plist
@QuickLookPreview/Info.plist
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose current TypeScript UTI assignment</name>
  <files></files>
  <action>
Run diagnostic commands to understand why TypeScript files aren't previewing:

1. Check what UTI macOS assigns to a .ts file:
   ```bash
   # Create a test file if needed
   echo "const x: number = 1;" > /tmp/test.ts
   mdls -name kMDItemContentType /tmp/test.ts
   ```

2. Check which apps claim TypeScript UTI:
   ```bash
   # List all handlers for .ts extension
   /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -dump | grep -i "typescript\|\.ts" | head -30
   ```

3. Check if dotViewer is registered:
   ```bash
   /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -dump | grep -i "dotviewer" | head -20
   ```

Document findings for next task.
  </action>
  <verify>Diagnostic output captured showing current UTI assignment and handler priority</verify>
  <done>Root cause identified (which UTI is assigned, which app has priority)</done>
</task>

<task type="auto">
  <name>Task 2: Apply UTI fix based on diagnosis</name>
  <files>dotViewer/Info.plist, QuickLookPreview/Info.plist</files>
  <action>
Based on Task 1 findings, apply the appropriate fix:

**If Xcode claims `.ts` with `com.apple.dt.sourcecode.typescript`:**
Add UTImportedTypeDeclarations to recognize Apple's TypeScript UTI and add it to QLSupportedContentTypes:

In dotViewer/Info.plist, add UTImportedTypeDeclarations section:
```xml
<key>UTImportedTypeDeclarations</key>
<array>
    <dict>
        <key>UTTypeIdentifier</key>
        <string>com.apple.dt.sourcecode.typescript</string>
        <key>UTTypeConformsTo</key>
        <array>
            <string>public.source-code</string>
        </array>
        <key>UTTypeTagSpecification</key>
        <dict>
            <key>public.filename-extension</key>
            <array>
                <string>ts</string>
            </array>
        </dict>
    </dict>
</array>
```

In QuickLookPreview/Info.plist, add Apple's TypeScript UTI to QLSupportedContentTypes:
```xml
<string>com.apple.dt.sourcecode.typescript</string>
```

**If dotViewer UTI is assigned but not working:**
- Rebuild app and ensure it's properly signed
- Re-register with Launch Services:
  ```bash
  /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -f /Applications/dotViewer.app
  ```

**After any changes:**
- Validate plist: `plutil -lint dotViewer/Info.plist`
- Rebuild: `xcodebuild -project dotViewer.xcodeproj -scheme dotViewer -quiet build`
  </action>
  <verify>Build succeeds, plutil validates plist files</verify>
  <done>UTI fix applied based on diagnosis</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>TypeScript/TSX QuickLook fix applied</what-built>
  <how-to-verify>
    1. Build and run the app (or install built .app to /Applications)
    2. Relaunch Finder: Option+Right-click Finder in Dock â†’ Relaunch
    3. Navigate to any .ts file
    4. Press Space to invoke QuickLook
    5. Confirm: Syntax-highlighted code preview appears (not document icon)
    6. Repeat for a .tsx file
  </how-to-verify>
  <resume-signal>Type "approved" if preview works, or describe what you see</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Diagnostic run and root cause identified
- [ ] Fix applied (UTI import or database refresh)
- [ ] Build succeeds
- [ ] User verified QuickLook preview works for .ts and .tsx files
</verification>

<success_criteria>
- TypeScript (.ts, .mts, .cts) files show code preview in QuickLook
- TSX (.tsx) files show code preview in QuickLook
- Syntax highlighting displays correctly
- UAT-002 resolved
</success_criteria>

<output>
After completion, create `.planning/phases/01-infoplist-uti-fixes/01-03-SUMMARY.md`

Update `.planning/phases/01-infoplist-uti-fixes/01-01-ISSUES.md`:
- Mark UAT-002 as RESOLVED with fix description
</output>
