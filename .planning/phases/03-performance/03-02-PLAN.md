---
phase: 03-performance
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [dotViewer/Info.plist, QuickLookPreview/Info.plist, Shared/FileTypeRegistry.swift]
autonomous: true
---

<objective>
Add comprehensive UTI declarations so 100+ common developer file extensions work with QuickLook out of the box.

Purpose: Users expect to preview many file types. Currently, only explicitly declared UTIs are routed to the extension. Adding broad coverage means most files "just work" without requiring app updates.
Output: Comprehensive UTI support for backup, config, log, and additional programming language files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@dotViewer/Info.plist (current UTExportedTypeDeclarations)
@QuickLookPreview/Info.plist (current QLSupportedContentTypes)
@Shared/FileTypeRegistry.swift (language mappings)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add comprehensive UTI declarations to main app</name>
  <files>dotViewer/Info.plist</files>
  <action>
Add UTExportedTypeDeclarations for the following file extensions, organized by category:

**Backup & Temp Files:**
- backup, bak, old, orig, tmp, temp, swp, swo
- dist, sample, example, default, template
- local, development, dev, prod, production, staging

**Config Files:**
- conf, cfg, config, ini, properties, prefs
- rc (generic rc files), editorconfig, prettierrc, eslintrc, babelrc
- npmrc, yarnrc, nvmrc
- htaccess, htpasswd
- lock (various lock files)

**Log & Data Files:**
- log, logs, out, err, debug
- pid, lock, cache
- csv, tsv, dat

**Additional Source Files:**
- lua, r, R, rmd, julia, jl
- nim, zig, v, d
- ex, exs (Elixir), erl, hrl (Erlang)
- clj, cljs, cljc (Clojure)
- fs, fsx, fsi (F#)
- hs, lhs (Haskell)
- ml, mli (OCaml)
- pl, pm (Perl)
- tcl, tk
- asm, s, S (Assembly)

**Web & Markup:**
- njk, nunjucks, jinja, j2, twig
- hbs, handlebars, mustache
- pug, jade, haml, slim
- liquid, ejs
- rst, adoc, asciidoc, textile, org

**DevOps & Infrastructure:**
- tf, tfvars, hcl (Terraform)
- nomad, consul, vault
- ansible, playbook
- helm, k8s, kubernetes
- vagrantfile, procfile

**Build & Package:**
- cmake, make, makefile, mk
- gradle, maven, pom
- cargo, cabal, mix
- gemfile, rakefile, guardfile
- justfile, taskfile

**Shell & Scripts:**
- fish, csh, tcsh, ksh, ash, dash
- ps1, psm1, psd1 (PowerShell)
- bat, cmd (Windows batch)
- vbs, vba (VBScript)

Each UTI declaration needs:
- UTTypeIdentifier: com.stianlars1.dotviewer.{extension}
- UTTypeConformsTo: [public.plain-text] (or appropriate parent)
- UTTypeDescription: {Readable name}
- UTTypeTagSpecification with public.filename-extension

Example format:
```xml
<dict>
    <key>UTTypeConformsTo</key>
    <array>
        <string>public.plain-text</string>
    </array>
    <key>UTTypeDescription</key>
    <string>Backup File</string>
    <key>UTTypeIdentifier</key>
    <string>com.stianlars1.dotviewer.backup</string>
    <key>UTTypeTagSpecification</key>
    <dict>
        <key>public.filename-extension</key>
        <array>
            <string>backup</string>
            <string>bak</string>
            <string>old</string>
            <string>orig</string>
        </array>
    </dict>
</dict>
```

Group related extensions in single UTI declarations where it makes sense (e.g., all backup extensions together).
  </action>
  <verify>Info.plist validates: plutil -lint dotViewer/Info.plist</verify>
  <done>50+ new file extensions declared as UTIs</done>
</task>

<task type="auto">
  <name>Task 2: Add UTIs to QuickLook extension's supported types</name>
  <files>QuickLookPreview/Info.plist</files>
  <action>
Add all new UTI identifiers to QLSupportedContentTypes array.

For each UTI added in Task 1, add its identifier string to the array:
```xml
<string>com.stianlars1.dotviewer.backup-files</string>
<string>com.stianlars1.dotviewer.config-files</string>
<!-- etc -->
```

Keep the existing UTIs and add new ones. Maintain alphabetical order within sections for maintainability.
  </action>
  <verify>Info.plist validates: plutil -lint QuickLookPreview/Info.plist</verify>
  <done>All new UTIs added to QLSupportedContentTypes</done>
</task>

<task type="auto">
  <name>Task 3: Update FileTypeRegistry with new built-in types</name>
  <files>Shared/FileTypeRegistry.swift</files>
  <action>
Add new SupportedFileType entries for the file extensions that need specific language highlighting.

Add new categories if needed:
- .config (for config files)
- .infrastructure (for DevOps files)
- .backup (for backup/temp files)

For each new extension, determine the appropriate highlightLanguage:
- Backup files: "plaintext" or inherit from original extension
- Config files (.conf, .cfg, .ini): "ini"
- Lock files (.lock): "json" or "yaml" depending on typical content
- Terraform (.tf, .tfvars): "hcl" or "plaintext"
- PowerShell (.ps1): "powershell"
- etc.

Use existing patterns in the file as reference. Keep isSystemUTI: false for all new custom UTIs.
  </action>
  <verify>Build succeeds, no compiler errors in FileTypeRegistry.swift</verify>
  <done>New file types registered with appropriate highlight languages</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] plutil -lint passes for both Info.plist files
- [ ] xcodebuild build succeeds
- [ ] Test: Create a .backup file, press Space in Finder → should preview
- [ ] Test: Create a .log file, press Space → should preview
- [ ] Test: Create a .conf file, press Space → should preview
</verification>

<success_criteria>
- All tasks completed
- 50+ new file extensions have UTI declarations
- QuickLook extension claims all new UTIs
- FileTypeRegistry provides language mappings
- Build succeeds without errors
- At least 3 file types verified working in QuickLook
</success_criteria>

<output>
After completion, create `.planning/phases/03-performance/03-02-SUMMARY.md`
</output>
