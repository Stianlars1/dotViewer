---
phase: 02-ui-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [dotViewer/FileTypesView.swift]
autonomous: true
---

<objective>
Add edit capability for custom file type extensions (Bug #2).

Purpose: Users can currently add and delete custom extensions but cannot edit them. This forces users to delete and re-add if they make a mistake or want to change the syntax highlighting language.
Output: Edit button on custom extension rows, edit sheet with pre-populated values, update functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dotViewer/FileTypesView.swift
@dotViewer/AddCustomExtensionSheet.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add edit callback and button to CustomExtensionRow</name>
  <files>dotViewer/FileTypesView.swift</files>
  <action>
Modify `CustomExtensionRow` struct (around line 192-230):

1. Add `onEdit` parameter to the struct:
```swift
struct CustomExtensionRow: View {
    let customExtension: CustomExtension
    let onEdit: () -> Void
    let onDelete: () -> Void
    ...
}
```

2. Add edit button before the delete button in the HStack (around line 220):
```swift
Button {
    onEdit()
} label: {
    Image(systemName: "pencil")
}
.buttonStyle(.borderless)

Button(role: .destructive) {
    onDelete()
} label: {
    Image(systemName: "trash")
}
.buttonStyle(.borderless)
```
  </action>
  <verify>Build succeeds: xcodebuild -project dotViewer.xcodeproj -scheme dotViewer -quiet build</verify>
  <done>CustomExtensionRow has onEdit parameter and pencil button</done>
</task>

<task type="auto">
  <name>Task 2: Create EditCustomExtensionSheet and wire up in FileTypesView</name>
  <files>dotViewer/FileTypesView.swift</files>
  <action>
1. Add state variable to FileTypesView (around line 7):
```swift
@State private var editingExtension: CustomExtension?
```

2. Create EditCustomExtensionSheet struct (add after CustomExtensionRow, before #Preview):
```swift
struct EditCustomExtensionSheet: View {
    @Environment(\.dismiss) private var dismiss

    let customExtension: CustomExtension
    let onSave: (CustomExtension) -> Void

    @State private var displayName: String
    @State private var selectedLanguage: String

    init(customExtension: CustomExtension, onSave: @escaping (CustomExtension) -> Void) {
        self.customExtension = customExtension
        self.onSave = onSave
        _displayName = State(initialValue: customExtension.displayName)
        _selectedLanguage = State(initialValue: customExtension.highlightLanguage)
    }

    private var isValid: Bool {
        !displayName.trimmingCharacters(in: .whitespaces).isEmpty
    }

    var body: some View {
        VStack(spacing: 0) {
            // Header
            HStack {
                Text("Edit Custom Extension")
                    .font(.headline)
                Spacer()
                Button {
                    dismiss()
                } label: {
                    Image(systemName: "xmark.circle.fill")
                        .foregroundStyle(.secondary)
                }
                .buttonStyle(.plain)
            }
            .padding()

            Divider()

            // Form
            Form {
                Section {
                    HStack {
                        Text(".")
                            .foregroundStyle(.secondary)
                        Text(customExtension.extensionName)
                            .foregroundStyle(.primary)
                    }
                } header: {
                    Text("File Extension")
                } footer: {
                    Text("Extension cannot be changed")
                        .font(.caption)
                        .foregroundStyle(.secondary)
                }

                Section {
                    TextField("Display Name", text: $displayName)
                } header: {
                    Text("Display Name")
                }

                Section {
                    Picker("Language", selection: $selectedLanguage) {
                        ForEach(HighlightLanguage.all) { lang in
                            Text(lang.displayName).tag(lang.id)
                        }
                    }
                    .pickerStyle(.menu)
                } header: {
                    Text("Syntax Highlighting")
                }
            }
            .formStyle(.grouped)
            .scrollContentBackground(.hidden)

            Divider()

            // Footer buttons
            HStack {
                Button("Cancel") {
                    dismiss()
                }
                .keyboardShortcut(.cancelAction)

                Spacer()

                Button("Save Changes") {
                    let updated = CustomExtension(
                        id: customExtension.id,
                        extensionName: customExtension.extensionName,
                        displayName: displayName.trimmingCharacters(in: .whitespaces),
                        highlightLanguage: selectedLanguage
                    )
                    onSave(updated)
                    dismiss()
                }
                .keyboardShortcut(.defaultAction)
                .disabled(!isValid)
                .buttonStyle(.borderedProminent)
            }
            .padding()
        }
        .frame(width: 400, height: 380)
    }
}
```

3. Update CustomExtensionRow usage in FileTypesView (around line 102-106):
```swift
CustomExtensionRow(
    customExtension: ext,
    onEdit: { editingExtension = ext },
    onDelete: { deleteCustomExtension(ext) }
)
```

4. Add sheet for editing after the existing showAddCustom sheet (around line 125):
```swift
.sheet(item: $editingExtension) { ext in
    EditCustomExtensionSheet(
        customExtension: ext,
        onSave: { updated in
            updateCustomExtension(updated)
        }
    )
}
```

5. Add updateCustomExtension function (after deleteCustomExtension, around line 145):
```swift
private func updateCustomExtension(_ updated: CustomExtension) {
    if let index = customExtensions.firstIndex(where: { $0.id == updated.id }) {
        customExtensions[index] = updated
        saveCustomExtensions()
    }
}
```
  </action>
  <verify>Build succeeds: xcodebuild -project dotViewer.xcodeproj -scheme dotViewer -quiet build</verify>
  <done>EditCustomExtensionSheet exists, edit button triggers sheet, saving updates the extension</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Build succeeds without errors
- [ ] No new warnings introduced
- [ ] Edit button visible on custom extension rows
- [ ] Edit sheet opens with pre-populated values
- [ ] Changes save correctly
</verification>

<success_criteria>
- CustomExtensionRow has edit button (pencil icon)
- Clicking edit opens EditCustomExtensionSheet with current values
- Display name and highlight language are editable
- Extension name is shown but not editable (it's the identifier)
- Saving updates the extension in SharedSettings
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-bug-fixes/02-01-SUMMARY.md`
</output>
